<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Docsify + Prism + Mermaid + PlantUML</title>

  <!-- Тема подсветки Prism -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-ghcolors.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/@markbattistella/docsify-charty@latest/dist/docsify-charty.min.css">
  <link
    rel="stylesheet"
    href="//cdn.jsdelivr.net/npm/docsify@4/themes/vue.css"
  />
</head>

<style>
  /* базовые поджатия */
  .markdown-section { max-width: 980px; margin: 0 auto; padding: 24px; }
  /* мобильная компоновка */
  @media (max-width: 600px) {
    .markdown-section { padding: 10px 14px; }
    .markdown-section h1 { font-size: 1.35rem; margin: .6em 0 .4em; }
    .markdown-section h2 { font-size: 1.15rem; margin: .6em 0 .35em; }
    .markdown-section pre { padding: 8px; }
    .markdown-section pre code { font-size: 12px; line-height: 1.4; }
    .markdown-section p, .markdown-section li { line-height: 1.5; }
    img { border-radius: 6px; }
  }
  /* тонкая правка таблиц/картинок на мобилке */
  .markdown-section table { display: block; overflow-x: auto; }
  .markdown-section img { max-width: 100%; height: auto; }
</style>

<style>
  .author-bar { display:flex; align-items:center; margin: 6px 0 14px; color:#888; }
  .author-bar .author-meta { font-size: .9rem; }
  .author-bar .dot { padding: 0 6px; }
  @media (max-width: 600px) { .author-bar { margin: 2px 0 10px; } }
</style>
<body>
  <div id="app"></div>

  <script>
    window.$docsify = {
      name: 'все статьи',
      nameLink: '#/',
      routerMode: 'hash',
      executeScript: true,
      plugins: [
        function (hook, vm) {
          hook.doneEach(function () {
            if (window.Prism && window.Prism.highlightAll) {
              window.Prism.highlightAll();
            }

            const meta = window.$docsify?.frontMatter || {};
            const author = meta.author || '@fromidiottojunior';
            const date = meta.date || new Date().toISOString().slice(0,10);
            const host = document.querySelector('.markdown-section');
            if (!host) return;

            // очищаем предыдущую панель (если была)
            host.querySelectorAll('.author-bar').forEach(n => n.remove());

            const bar = document.createElement('div');
            bar.className = 'author-bar';
            bar.innerHTML = `
              <div class="author-meta">
                <span class="author-name">by ${author}</span>
                <span class="dot">·</span>
                <span class="author-date">${date}</span>
              </div>
            `;
            //host.append(bar);

            const h1 = document.querySelector('.content h1, #main h1, h1, .content h2, #main h2, h2, .content h3, #main h3, h3');
            const pageTitle = meta.title ? h1 ? h1.textContent.trim() : '' : '';
            const siteName = 'статьи @fromidiottojunior';
            document.title = pageTitle ? `${pageTitle} — ${siteName}` : siteName;
          });
        },
        function (hook, vm) {
          let pdfBtn;

          function ensureBtn() {
            if (pdfBtn && document.body.contains(pdfBtn)) return pdfBtn;
            pdfBtn = document.createElement('a');
            pdfBtn.id = 'download-pdf-btn';
            pdfBtn.className = 'pdf-link';
            pdfBtn.textContent = '⬇︎ Скачать PDF';
            Object.assign(pdfBtn.style, {
              position: 'fixed',
              right: '16px',
              bottom: '16px',
              zIndex: 9999,
              padding: '10px 14px',
              border: 'none',
              borderRadius: '10px',
              boxShadow: '0 8px 20px rgba(0,0,0,.15)',
              background: '#42b983',
              color: '#fff',
              fontWeight: '600',
              textDecoration: 'none',
              display: 'none'
            });
            document.body.appendChild(pdfBtn);
            return pdfBtn;
          }

          async function updatePdfLink() {
            const meta = window.$docsify?.frontMatter || {};
            const host = document.querySelector('.markdown-section');
            const btn = ensureBtn();
            if (!host) { btn.style.display = 'none'; return; }
            let href = (meta.pdf || '').trim();

            if (!href) {
              const file = vm.route.file || 'README.md';
              const base = (window.$docsify.basePath || '').replace(/\/+$/, '');
              href = `${base}/_pdf/${file.replace(/^docs\//,'').replace(/\.md$/i,'')}.pdf`;
            }

            try {
              const res = await fetch(href, { method: 'HEAD', cache: 'no-store' });
              if (!res.ok) throw new Error('404');
              btn.href = href;
              btn.download = '';
              btn.style.display = '';
            } catch {
              btn.style.display = 'none';
            }
          }

          hook.doneEach(updatePdfLink);
        }
      ]
    };
  </script>

  <!-- Docsify -->
  <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>

  <script src="//cdn.jsdelivr.net/npm/@sujaykumarh/docsify-plugin-title@2.x/dist/plugin.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify-pagination/dist/docsify-pagination.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify-copy-code/dist/docsify-copy-code.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/front-matter.min.js"></script>
  <!-- подключи после docsify.min.js -->
  <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"></script>

  <script src="//unpkg.com/js-yaml@3/dist/js-yaml.js"></script>
  <script src="//unpkg.com/yaml-front-matter@4/dist/yamlFront.js"></script>

  <script src="https://unpkg.com/docsify-plugin-flexible-alerts"></script>
  <script src="https://unpkg.com/@markbattistella/docsify-charty@latest/dist/docsify-charty.min.js"></script>

  <!-- Mermaid -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify-mermaid/dist/docsify-mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: true });</script>

  <!-- PlantUML через Kroki -->
  <script src="https://cdn.jsdelivr.net/npm/docsify-kroki/dist/docsify-kroki.min.js"></script>
  <script>
    window.$docsify.kroki = { target: 'https://kroki.io', enableTranscoder: true };
  </script>

  <!-- Prism core -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>

  <!-- ВАЖНО: зависимости в правильном порядке -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-markup.min.js"></script>            <!-- XML/HTML -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-clike.min.js"></script>             <!-- зависимость для PHP -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-markup-templating.min.js"></script> <!-- ОБЯЗАТЕЛЬНО для PHP -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-php.min.js"></script>

  <!-- Остальные языки -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-json.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-go.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-http.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-protobuf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-graphql.min.js"></script>
</body>
</html>
